<!--
================================================================================
SBNC WIDGET CONFIGURATION PAGE
================================================================================
This is the master configuration block for SBNC inline widgets.
Paste this entire block into a WA Custom HTML gadget on your Config Page.

INSTRUCTIONS FOR TECH CHAIRS:
1. Create a new page in WA called "Widget Config" (or similar)
2. Set page access to "Administrators only"
3. Add a Custom HTML gadget
4. Paste this entire block
5. Edit the JSON between CONFIG START and CONFIG END markers
6. Click "Validate Config" button to check for errors
7. Publish the page

WIDGETS READ THIS CONFIG BY:
- Fetching this page URL
- Parsing the JSON from the config block
- Using the settings to configure themselves

DO NOT MODIFY anything outside the CONFIG START/END markers unless you
know what you're doing.
================================================================================
-->

<style>
  .sbnc-config-container {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
  }

  .sbnc-config-header {
    background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
    color: white;
    padding: 20px 24px;
    border-radius: 8px 8px 0 0;
    margin-bottom: 0;
  }

  .sbnc-config-header h2 {
    margin: 0 0 8px 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .sbnc-config-header p {
    margin: 0;
    opacity: 0.9;
    font-size: 0.95rem;
  }

  .sbnc-config-instructions {
    background: #f0f7ff;
    border: 1px solid #c5ddf8;
    border-top: none;
    padding: 16px 24px;
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .sbnc-config-instructions h3 {
    margin: 0 0 12px 0;
    font-size: 1rem;
    color: #1e3a5f;
  }

  .sbnc-config-instructions ol {
    margin: 0;
    padding-left: 20px;
  }

  .sbnc-config-instructions li {
    margin-bottom: 6px;
  }

  .sbnc-config-instructions code {
    background: #e8f4fd;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'SF Mono', Monaco, 'Courier New', monospace;
    font-size: 0.85em;
  }

  .sbnc-config-warning {
    background: #fff8e6;
    border: 1px solid #f5d060;
    border-radius: 6px;
    padding: 12px 16px;
    margin: 16px 0;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .sbnc-config-warning-icon {
    font-size: 1.2rem;
    line-height: 1;
  }

  .sbnc-config-warning-text {
    font-size: 0.9rem;
    color: #6b5900;
  }

  .sbnc-config-editor {
    border: 2px solid #d1d5db;
    border-radius: 0 0 8px 8px;
    overflow: hidden;
  }

  .sbnc-config-editor-header {
    background: #f3f4f6;
    padding: 12px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #d1d5db;
  }

  .sbnc-config-editor-title {
    font-weight: 600;
    font-size: 0.9rem;
    color: #374151;
  }

  .sbnc-config-buttons {
    display: flex;
    gap: 8px;
  }

  .sbnc-config-btn {
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.15s ease;
  }

  .sbnc-config-btn-primary {
    background: #2563eb;
    color: white;
  }

  .sbnc-config-btn-primary:hover {
    background: #1d4ed8;
  }

  .sbnc-config-btn-secondary {
    background: white;
    color: #374151;
    border: 1px solid #d1d5db;
  }

  .sbnc-config-btn-secondary:hover {
    background: #f9fafb;
  }

  .sbnc-config-status {
    padding: 10px 16px;
    font-size: 0.85rem;
    display: none;
  }

  .sbnc-config-status.valid {
    display: block;
    background: #d1fae5;
    color: #065f46;
    border-bottom: 1px solid #6ee7b7;
  }

  .sbnc-config-status.invalid {
    display: block;
    background: #fee2e2;
    color: #991b1b;
    border-bottom: 1px solid #fca5a5;
  }

  .sbnc-config-json {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 20px;
    font-family: 'SF Mono', Monaco, 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.5;
    white-space: pre;
    overflow-x: auto;
    min-height: 400px;
  }

  .sbnc-config-json .comment {
    color: #6a9955;
  }

  .sbnc-config-json .key {
    color: #9cdcfe;
  }

  .sbnc-config-json .string {
    color: #ce9178;
  }

  .sbnc-config-json .number {
    color: #b5cea8;
  }

  .sbnc-config-json .boolean {
    color: #569cd6;
  }

  .sbnc-config-json .null {
    color: #569cd6;
  }

  .sbnc-config-footer {
    background: #f9fafb;
    border-top: 1px solid #d1d5db;
    padding: 16px;
    font-size: 0.8rem;
    color: #6b7280;
  }

  .sbnc-config-hidden {
    display: none !important;
  }

  /* Marker comments are styled but invisible in rendered view */
  .sbnc-config-marker {
    display: none;
  }
</style>

<div class="sbnc-config-container">

  <div class="sbnc-config-header">
    <h2>SBNC Widget Configuration</h2>
    <p>Master settings for ClubCalendar and other inline widgets</p>
  </div>

  <div class="sbnc-config-instructions">
    <h3>How to Edit This Configuration</h3>
    <ol>
      <li>Click <strong>Edit</strong> on this page in WA admin</li>
      <li>Click the <strong>Custom HTML gadget</strong> containing this block</li>
      <li>Switch to <strong>Source/HTML view</strong> in the editor</li>
      <li>Find the JSON between <code>&lt;!-- CONFIG START --&gt;</code> and <code>&lt;!-- CONFIG END --&gt;</code></li>
      <li>Make your changes to the JSON values (not the structure)</li>
      <li>Click <strong>Validate Config</strong> button below to check for errors</li>
      <li><strong>Save</strong> the gadget, then <strong>Publish</strong> the page</li>
    </ol>

    <div class="sbnc-config-warning">
      <span class="sbnc-config-warning-icon">&#9888;</span>
      <span class="sbnc-config-warning-text">
        <strong>Important:</strong> Only edit values inside quotes. Do not remove commas, brackets, or colons.
        If validation fails, undo your changes and try again.
      </span>
    </div>
  </div>

  <div class="sbnc-config-editor">
    <div class="sbnc-config-editor-header">
      <span class="sbnc-config-editor-title">Configuration (JSON)</span>
      <div class="sbnc-config-buttons">
        <button class="sbnc-config-btn sbnc-config-btn-secondary" onclick="sbncCopyConfig()">
          Copy Config
        </button>
        <button class="sbnc-config-btn sbnc-config-btn-primary" onclick="sbncValidateConfig()">
          Validate Config
        </button>
      </div>
    </div>

    <div id="sbnc-config-status" class="sbnc-config-status"></div>

    <!--
    ============================================================================
    CONFIGURATION DATA BLOCK
    ============================================================================
    Widgets read this JSON to get their settings.
    The script element with id="sbnc-widget-config" is what widgets look for.
    ============================================================================
    -->

    <script type="application/json" id="sbnc-widget-config">
<!-- CONFIG START - Edit only the values below, not the structure -->
{
  "_version": "1.0.0",
  "_lastModified": "2025-12-26",
  "_modifiedBy": "Tech Chair Name",

  "organization": {
    "name": "Santa Barbara Newcomers Club",
    "shortName": "SBNC",
    "timezone": "America/Los_Angeles"
  },

  "clubcalendar": {
    "dataSource": {
      "type": "ics-feed",
      "url": "https://sbnewcomers.wildapricot.org/widget/Calendar/YOUR_CALENDAR_ID.ics",
      "refreshIntervalMinutes": 15
    },
    "display": {
      "defaultView": "month",
      "views": ["month", "week", "list"],
      "showPastEvents": false,
      "maxEventsVisible": 50
    },
    "eventColors": {
      "default": "#2563eb",
      "social": "#16a34a",
      "interest": "#9333ea",
      "general": "#dc2626"
    },
    "features": {
      "showRegistrationStatus": false,
      "showEventDetails": true,
      "linkToEventPage": true,
      "eventPageBaseUrl": "https://sbnewcomers.wildapricot.org/event-"
    }
  },

  "styling": {
    "fontFamily": "system-ui, -apple-system, sans-serif",
    "primaryColor": "#1e3a5f",
    "borderRadius": "8px"
  }
}
<!-- CONFIG END - Do not edit below this line -->
    </script>

    <!-- Visual display of the config (read-only, for reference) -->
    <div class="sbnc-config-json" id="sbnc-config-display">
      Loading configuration...
    </div>

  </div>

  <div class="sbnc-config-footer">
    <strong>Config Page URL:</strong> Copy this page's URL and use it as the <code>configUrl</code> in your widget embed code.<br>
    <strong>Last validated:</strong> <span id="sbnc-last-validated">Not yet validated</span>
  </div>

</div>

<script>
(function() {
  'use strict';

  // Display the config in a readable format
  function displayConfig() {
    var configEl = document.getElementById('sbnc-widget-config');
    var displayEl = document.getElementById('sbnc-config-display');

    if (!configEl || !displayEl) return;

    try {
      var configText = configEl.textContent;
      // Remove the HTML comment markers if present
      configText = configText.replace(/<!--[\s\S]*?-->/g, '').trim();

      var config = JSON.parse(configText);
      var formatted = JSON.stringify(config, null, 2);

      // Syntax highlight the JSON
      formatted = formatted
        .replace(/("_[^"]+":)/g, '<span class="comment">$1</span>')
        .replace(/("(?!_)[^"]+":)/g, '<span class="key">$1</span>')
        .replace(/(: "(?:[^"\\]|\\.)*")/g, function(match) {
          return ': <span class="string">' + match.slice(2) + '</span>';
        })
        .replace(/(: \d+\.?\d*)/g, ': <span class="number">$1</span>'.replace(': ', ''))
        .replace(/(: )(true|false)/g, '$1<span class="boolean">$2</span>')
        .replace(/(: )(null)/g, '$1<span class="null">$2</span>');

      displayEl.innerHTML = formatted;
    } catch (e) {
      displayEl.innerHTML = '<span style="color: #f87171;">Error parsing config: ' + e.message + '</span>\n\n' +
        'Raw content:\n' + (configEl.textContent || '(empty)');
    }
  }

  // Validate the config
  window.sbncValidateConfig = function() {
    var configEl = document.getElementById('sbnc-widget-config');
    var statusEl = document.getElementById('sbnc-config-status');
    var validatedEl = document.getElementById('sbnc-last-validated');

    if (!configEl || !statusEl) return;

    try {
      var configText = configEl.textContent;
      // Remove the HTML comment markers if present
      configText = configText.replace(/<!--[\s\S]*?-->/g, '').trim();

      var config = JSON.parse(configText);

      // Basic structure validation
      var errors = [];

      if (!config.organization) {
        errors.push('Missing "organization" section');
      } else {
        if (!config.organization.name) errors.push('Missing organization.name');
        if (!config.organization.timezone) errors.push('Missing organization.timezone');
      }

      if (!config.clubcalendar) {
        errors.push('Missing "clubcalendar" section');
      } else {
        if (!config.clubcalendar.dataSource) {
          errors.push('Missing clubcalendar.dataSource');
        } else {
          if (!config.clubcalendar.dataSource.url) {
            errors.push('Missing clubcalendar.dataSource.url');
          } else if (config.clubcalendar.dataSource.url.indexOf('YOUR_CALENDAR_ID') !== -1) {
            errors.push('Replace YOUR_CALENDAR_ID with your actual WA calendar ID');
          }
        }
      }

      if (errors.length > 0) {
        statusEl.className = 'sbnc-config-status invalid';
        statusEl.innerHTML = '<strong>&#10007; Validation failed:</strong><br>' +
          errors.map(function(e) { return '&bull; ' + e; }).join('<br>');
      } else {
        statusEl.className = 'sbnc-config-status valid';
        statusEl.innerHTML = '<strong>&#10003; Configuration is valid!</strong> ' +
          'Found ' + Object.keys(config).length + ' top-level sections.';
        validatedEl.textContent = new Date().toLocaleString();
      }

      // Refresh the display
      displayConfig();

    } catch (e) {
      statusEl.className = 'sbnc-config-status invalid';
      statusEl.innerHTML = '<strong>&#10007; JSON Parse Error:</strong> ' + e.message +
        '<br><br>Check for missing commas, extra commas, or unmatched brackets.';
    }
  };

  // Copy config to clipboard
  window.sbncCopyConfig = function() {
    var configEl = document.getElementById('sbnc-widget-config');
    if (!configEl) return;

    var configText = configEl.textContent;
    configText = configText.replace(/<!--[\s\S]*?-->/g, '').trim();

    try {
      var config = JSON.parse(configText);
      var formatted = JSON.stringify(config, null, 2);

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(formatted).then(function() {
          alert('Configuration copied to clipboard!');
        });
      } else {
        // Fallback for older browsers
        var textarea = document.createElement('textarea');
        textarea.value = formatted;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Configuration copied to clipboard!');
      }
    } catch (e) {
      alert('Error copying config: ' + e.message);
    }
  };

  // Initialize on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', displayConfig);
  } else {
    displayConfig();
  }

})();
</script>

<!--
================================================================================
HOW WIDGETS READ THIS CONFIG
================================================================================
Widgets fetch this page and extract the config like this:

  fetch('/widget-config')
    .then(response => response.text())
    .then(html => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const configEl = doc.getElementById('sbnc-widget-config');
      const configText = configEl.textContent
        .replace(/<!--[\s\S]*?-->/g, '')
        .trim();
      const config = JSON.parse(configText);
      // Use config...
    });

================================================================================
-->
