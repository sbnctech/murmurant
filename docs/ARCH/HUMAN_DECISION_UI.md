# Human Decision UI

```
Audience: Developers, Operators
Purpose: Document the human-in-the-loop decision interface
Classification: Architecture Document
```

---

## Overview

The Human Decision UI provides a control panel where operators review, approve, or abort pending actions. This surface enforces the principle that **humans decide, not automation**.

**Location:** `/admin/actions`

---

## Design Principles

### No Auto-Approval

Every action that affects data requires explicit human approval:

- **Migration imports** - Member/event data from external systems
- **Bulk operations** - Mass updates to records
- **Publishing actions** - Content going live
- **Destructive operations** - Deletions or irreversible changes

The system may *prepare* actions, but never *execute* them without approval.

### All Actions Logged

Per Charter P1 (audit trail), every decision is recorded:

| Field | Description |
|-------|-------------|
| `actionId` | Unique identifier for the pending action |
| `decision` | `approve` or `abort` |
| `decidedBy` | Member ID of the approver |
| `decidedAt` | Timestamp of decision |
| `rationale` | Optional text explaining the decision |

### Preview Before Commit

Operators can preview the effect of an action before approving:

- **Migration previews** show sample records and validation results
- **Publish previews** show rendered content
- **Bulk operation previews** show affected record counts

Previews are read-only and do not modify data.

---

## UI Components

### Pending Actions Table

The main table shows actions awaiting decision:

| Column | Description |
|--------|-------------|
| Type | Category badge (migration, publish, bulk, etc.) |
| Action | Title and description |
| Records | Number of affected records |
| Created | When and by whom |
| Preview | Button to view preview (if available) |
| Decision | Approve / Abort buttons |

### Decision Modal

When clicking Approve or Abort, a modal prompts for:

1. **Confirmation** - Explicit acknowledgment
2. **Rationale** - Optional explanation for audit log

This friction is intentional - it prevents accidental clicks.

### Recent Decisions

Shows recently processed actions with their status:

- **Approved** - Action was executed
- **Aborted** - Action was cancelled
- **Expired** - Action timed out without decision

---

## Action Lifecycle

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Created   │────▶│   Pending   │────▶│   Decided   │
└─────────────┘     └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   Expired   │
                    └─────────────┘
```

**States:**

- **Created** - Action prepared by system or operator
- **Pending** - Awaiting human decision
- **Approved** - Human approved; action executed
- **Aborted** - Human aborted; action cancelled
- **Expired** - No decision within timeout; action cancelled

---

## Integration Points

### Intent Manifest

Actions originate from intent manifests (see INTENT_MANIFEST_SCHEMA.md):

```typescript
// TODO: Wire to intent manifest system
interface IntentManifest {
  intentId: string;
  type: ActionType;
  title: string;
  description: string;
  affectedRecords: RecordSummary[];
  createdAt: string;
  createdBy: string;
  expiresAt: string | null;
}
```

### Preview Surface

Previews are generated by the preview system (see PREVIEW_SURFACE_CONTRACT.md):

```typescript
// TODO: Wire to preview generator
async function getPreview(actionId: string): Promise<PreviewReport> {
  // Generate read-only preview of action's effect
}
```

### Audit Log

Decisions are recorded via the audit system:

```typescript
// TODO: Wire to audit mechanism
await auditMutation(req, auth.context, {
  action: decision === "approve" ? "APPROVE" : "ABORT",
  capability: "actions:decide",
  objectType: "PendingAction",
  objectId: actionId,
  metadata: { rationale },
});
```

---

## Security Considerations

### Authorization

Only users with `actions:decide` capability can approve or abort:

```typescript
// Server-side check (P2: default deny)
const auth = await requireCapability(req, "actions:decide");
if (!auth.allowed) {
  return forbidden();
}
```

### Object Scope

Each action is scoped to specific records:

- Operators can only approve actions they have permission to affect
- Cross-organization actions require elevated permissions

### Timeout

Actions expire after a configurable period (default: 24 hours):

- Expired actions are automatically aborted
- Operators are notified of expiring actions
- Timeout prevents stale actions from lingering

---

## Test IDs

For E2E testing:

| Element | Test ID |
|---------|---------|
| Page root | `admin-actions-root` |
| Notice banner | `admin-actions-notice` |
| Loading state | `admin-actions-loading` |
| Empty state | `admin-actions-empty` |
| Pending table | `admin-actions-pending-table` |
| Action row | `admin-actions-row-{id}` |
| Preview button | `admin-actions-preview-{id}` |
| Approve button | `admin-actions-approve-{id}` |
| Abort button | `admin-actions-abort-{id}` |
| Rationale modal | `admin-actions-rationale-modal` |
| Rationale input | `admin-actions-rationale-input` |
| Confirm button | `admin-actions-rationale-confirm` |

---

## Implementation Status

### Completed

- [x] Admin page at `/admin/actions`
- [x] Pending actions table with type badges
- [x] Approve/Abort buttons with confirmation modal
- [x] Rationale capture for audit log
- [x] Recent decisions display
- [x] Test IDs for E2E coverage

### TODO: Integration

- [ ] Wire to `/api/v1/admin/actions` endpoint
- [ ] Connect to intent manifest system
- [ ] Integrate preview surface
- [ ] Add audit logging via `auditMutation()`
- [ ] Implement action timeout/expiry
- [ ] Add notification for expiring actions

### TODO: Enhancement

- [ ] Filter by action type
- [ ] Search actions
- [ ] Batch approve/abort
- [ ] Action history pagination
- [ ] Email notifications for pending actions

---

## Related Documents

- [Architectural Charter](../ARCHITECTURAL_CHARTER.md) - Core principles (P1, P2, P5, P10)
- [Intent Manifest Schema](INTENT_MANIFEST_SCHEMA.md) - Action intent structure
- [Preview Surface Contract](PREVIEW_SURFACE_CONTRACT.md) - Preview generation
- [Reversibility Contract](REVERSIBILITY_CONTRACT.md) - Abort guarantees

---

## Revision History

| Date | Change |
|------|--------|
| 2025-12-26 | Initial document |

---

_This document describes the human decision interface. For implementation details, see the source files in `src/app/admin/actions/`._
