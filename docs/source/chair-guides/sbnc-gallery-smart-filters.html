<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <title>SBNC Photo Gallery - Smart Filters</title>
    
    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
    
    <!-- Select2 for searchable dropdowns -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        /* Filter bar */
        .filter-bar {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 180px;
        }
        .filter-group label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .filter-group select {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        .filter-group select:hover {
            border-color: #2c5aa0;
        }
        .filter-group select:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44,90,160,0.2);
        }
        
        /* Member search with Select2 */
        .member-search-group {
            flex: 1;
            min-width: 280px;
            max-width: 400px;
        }
        .select2-container {
            width: 100% !important;
        }
        .select2-container--default .select2-selection--single {
            height: 42px;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 28px;
            padding-left: 0;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 40px;
        }
        .select2-container--default .select2-search--dropdown .select2-search__field {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .select2-results__option {
            padding: 10px 12px;
        }
        .select2-results__option--highlighted {
            background-color: #2c5aa0 !important;
        }
        
        /* Action buttons */
        .filter-actions {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        .btn-clear {
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            height: 42px;
        }
        .btn-clear:hover {
            background: #e0e0e0;
        }
        
        /* Active filters display */
        .active-filters {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: none;
        }
        .active-filters.visible {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        .active-filters-label {
            font-size: 12px;
            color: #666;
            margin-right: 5px;
        }
        .filter-tag {
            display: inline-flex;
            align-items: center;
            background: #e8f0fe;
            color: #2c5aa0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 13px;
        }
        .filter-tag .remove {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.7;
        }
        .filter-tag .remove:hover {
            opacity: 1;
        }
        .filter-tag.person {
            background: #fce4ec;
            color: #c2185b;
        }
        .filter-tag.event {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        /* Results info */
        .results-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 5px;
        }
        .results-count {
            font-size: 14px;
            color: #666;
        }
        .results-count strong {
            color: #333;
        }
        .view-mode {
            font-size: 13px;
            color: #888;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        /* Gallery container */
        .gallery-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Event Album Grid (browse mode) */
        .event-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .event-card {
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .event-card-image {
            position: relative;
            height: 180px;
            overflow: hidden;
        }
        .event-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .event-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            padding: 40px 15px 15px;
            color: white;
        }
        .event-card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 3px;
        }
        .event-card-meta {
            font-size: 13px;
            opacity: 0.9;
        }
        .event-card-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
        }
        .event-card-activity {
            padding: 12px 15px;
            font-size: 13px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .activity-icon {
            font-size: 16px;
        }
        
        /* Photo Grid (when filtered) */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        .photo-thumb {
            aspect-ratio: 4/3;
            overflow: hidden;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
        }
        .photo-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.2s;
        }
        .photo-thumb:hover img {
            transform: scale(1.05);
        }
        .photo-thumb-title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 20px 10px 8px;
            font-size: 12px;
        }
        
        /* Grouped Photos (person filter) */
        .event-section {
            margin-bottom: 30px;
        }
        .event-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        .event-section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .event-section-title .date {
            font-weight: normal;
            color: #888;
            font-size: 14px;
        }
        .event-section-count {
            font-size: 13px;
            color: #666;
            background: #f0f0f0;
            padding: 4px 12px;
            border-radius: 12px;
        }
        .event-section-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        .show-more-link {
            grid-column: 1 / -1;
            text-align: center;
            padding: 10px;
            color: #2c5aa0;
            cursor: pointer;
            font-size: 14px;
        }
        .show-more-link:hover {
            text-decoration: underline;
        }
        
        /* Member option in dropdown */
        .member-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .member-option img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }
        .member-option .name {
            font-weight: 500;
        }
        .member-option .count {
            color: #888;
            font-size: 12px;
        }
        
        /* Breadcrumb */
        .breadcrumb {
            margin-bottom: 15px;
            font-size: 14px;
        }
        .breadcrumb a {
            color: #2c5aa0;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        .breadcrumb span {
            color: #666;
        }
        
        /* Help text */
        .help-text {
            background: #f0f7ff;
            border-left: 4px solid #2c5aa0;
            padding: 12px 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #444;
        }
        
        /* MOBILE RESPONSIVE STYLES */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            h1 {
                font-size: 22px;
            }
            .subtitle {
                font-size: 14px;
                margin-bottom: 15px;
            }
            .filter-bar {
                padding: 15px;
            }
            .filter-row {
                flex-direction: column;
                gap: 12px;
            }
            .filter-group {
                width: 100%;
                min-width: unset;
            }
            .member-search-group {
                max-width: 100%;
            }
            .filter-actions {
                width: 100%;
                justify-content: stretch;
            }
            .filter-actions .btn-clear {
                flex: 1;
            }
            .active-filters {
                flex-wrap: wrap;
            }
            .results-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .event-grid {
                grid-template-columns: 1fr;
            }
            .event-card-image {
                height: 200px;
            }
            .photo-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            .event-section-photos {
                grid-template-columns: repeat(2, 1fr);
            }
            .event-section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .event-section-title {
                font-size: 16px;
            }
            .gallery-container {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 18px;
            }
            .photo-grid {
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }
            .photo-thumb-title {
                font-size: 10px;
                padding: 15px 5px 5px;
            }
            .event-section-photos {
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }
        }
        
        /* Lightbox overlay (simple) */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .lightbox.active {
            display: flex;
        }
        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 5px;
        }
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>üå¥ Santa Barbara Newcomers Club Photo Gallery</h1>
<p class="subtitle">Browse photos from SBNC events ‚Ä¢ Find yourself and friends</p>

<!-- Filter Bar -->
<div class="filter-bar">
    <div class="filter-row">
        <!-- Member Search (Primary) -->
        <div class="filter-group member-search-group">
            <label>üîç Find a Member</label>
            <select id="member-search" class="member-select">
                <option value="">Type to search members...</option>
            </select>
        </div>
        
        <!-- Activity Group -->
        <div class="filter-group">
            <label>Activity Group</label>
            <select id="filter-activity">
                <option value="">All Activities</option>
                <option value="happy-hikers">ü•æ Happy Hikers</option>
                <option value="golf">‚õ≥ Golf Group</option>
                <option value="wine">üç∑ Wine Club</option>
                <option value="cycling">üö¥ Cycling</option>
                <option value="book-club">üìö Book Club</option>
                <option value="dining">üçΩÔ∏è Dining Out</option>
                <option value="social">üéâ Social Events</option>
            </select>
        </div>
        
        <!-- Event -->
        <div class="filter-group">
            <label>Event</label>
            <select id="filter-event">
                <option value="">All Events</option>
                <optgroup label="2024">
                    <option value="holiday-party-2024">Holiday Party 2024</option>
                    <option value="fall-picnic-2024">Fall Picnic 2024</option>
                    <option value="summer-bbq-2024">Summer BBQ 2024</option>
                    <option value="spring-gala-2024">Spring Gala 2024</option>
                </optgroup>
                <optgroup label="2023">
                    <option value="holiday-party-2023">Holiday Party 2023</option>
                    <option value="fall-picnic-2023">Fall Picnic 2023</option>
                </optgroup>
            </select>
        </div>
        
        <!-- Year -->
        <div class="filter-group">
            <label>Year</label>
            <select id="filter-year">
                <option value="">All Years</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
            </select>
        </div>
        
        <!-- Clear Button -->
        <div class="filter-actions">
            <button class="btn-clear" onclick="clearFilters()">Clear All</button>
        </div>
    </div>
    
    <!-- Active Filters Display -->
    <div class="active-filters" id="active-filters"></div>
</div>

<!-- Results Info -->
<div class="results-info">
    <div class="results-count" id="results-count">
        Showing <strong>8 events</strong>
    </div>
    <div class="view-mode" id="view-mode">
        üìÅ Browse Events
    </div>
</div>

<!-- Gallery Container -->
<div class="gallery-container">
    <div id="gallery-content"></div>
</div>

<!-- Simple Lightbox -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
    <span class="lightbox-close">&times;</span>
    <img id="lightbox-img" src="">
</div>

<script>
// Sample member data
const members = [
    { id: 'john-smith', name: 'John Smith', photoCount: 45, thumb: 'https://i.pravatar.cc/60?img=1' },
    { id: 'mary-johnson', name: 'Mary Johnson', photoCount: 38, thumb: 'https://i.pravatar.cc/60?img=5' },
    { id: 'bob-wilson', name: 'Bob Wilson', photoCount: 52, thumb: 'https://i.pravatar.cc/60?img=3' },
    { id: 'sarah-davis', name: 'Sarah Davis', photoCount: 29, thumb: 'https://i.pravatar.cc/60?img=9' },
    { id: 'tom-brown', name: 'Tom Brown', photoCount: 41, thumb: 'https://i.pravatar.cc/60?img=7' },
    { id: 'jennifer-lee', name: 'Jennifer Lee', photoCount: 33, thumb: 'https://i.pravatar.cc/60?img=10' },
    { id: 'michael-chen', name: 'Michael Chen', photoCount: 27, thumb: 'https://i.pravatar.cc/60?img=11' },
    { id: 'lisa-martinez', name: 'Lisa Martinez', photoCount: 36, thumb: 'https://i.pravatar.cc/60?img=12' },
    { id: 'david-anderson', name: 'David Anderson', photoCount: 44, thumb: 'https://i.pravatar.cc/60?img=13' },
    { id: 'susan-taylor', name: 'Susan Taylor', photoCount: 31, thumb: 'https://i.pravatar.cc/60?img=14' },
];

// Sample events data
const events = [
    { id: 'holiday-party-2024', name: 'Holiday Party 2024', date: 'Dec 14, 2024', 
      activity: 'social', activityName: 'üéâ Social Events', photoCount: 47,
      coverImage: 'https://images.unsplash.com/photo-1482517967863-00e15c9b44be?w=600' },
    { id: 'fall-picnic-2024', name: 'Fall Picnic 2024', date: 'Oct 15, 2024', 
      activity: 'social', activityName: 'üéâ Social Events', photoCount: 35,
      coverImage: 'https://images.unsplash.com/photo-1529543544277-05bfc67e5647?w=600' },
    { id: 'happy-hikers-nov', name: 'Cold Spring Trail', date: 'Nov 10, 2024', 
      activity: 'happy-hikers', activityName: 'ü•æ Happy Hikers', photoCount: 23,
      coverImage: 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=600' },
    { id: 'happy-hikers-oct', name: 'Inspiration Point', date: 'Oct 20, 2024', 
      activity: 'happy-hikers', activityName: 'ü•æ Happy Hikers', photoCount: 18,
      coverImage: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=600' },
    { id: 'golf-sandpiper', name: 'Sandpiper Tournament', date: 'Oct 8, 2024', 
      activity: 'golf', activityName: '‚õ≥ Golf Group', photoCount: 28,
      coverImage: 'https://images.unsplash.com/photo-1535131749006-b7f58c99034b?w=600' },
    { id: 'golf-glen-annie', name: 'Glen Annie Outing', date: 'Nov 5, 2024', 
      activity: 'golf', activityName: '‚õ≥ Golf Group', photoCount: 22,
      coverImage: 'https://images.unsplash.com/photo-1593111774240-d529f12cf4bb?w=600' },
    { id: 'wine-santa-ynez', name: 'Santa Ynez Tour', date: 'Oct 25, 2024', 
      activity: 'wine', activityName: 'üç∑ Wine Club', photoCount: 31,
      coverImage: 'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=600' },
    { id: 'wine-los-olivos', name: 'Los Olivos Tasting', date: 'Nov 15, 2024', 
      activity: 'wine', activityName: 'üç∑ Wine Club', photoCount: 26,
      coverImage: 'https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=600' },
];

// Sample photos data (with event and member associations)
const photos = [
    // Fall Picnic 2024
    { id: 1, src: 'https://images.unsplash.com/photo-1529543544277-05bfc67e5647?w=1200',
      thumb: 'https://images.unsplash.com/photo-1529543544277-05bfc67e5647?w=400',
      title: 'Group Photo', event: 'fall-picnic-2024', members: ['john-smith', 'mary-johnson', 'bob-wilson'] },
    { id: 2, src: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1200',
      thumb: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400',
      title: 'Food Spread', event: 'fall-picnic-2024', members: [] },
    { id: 3, src: 'https://images.unsplash.com/photo-1543007630-9710e4a00a20?w=1200',
      thumb: 'https://images.unsplash.com/photo-1543007630-9710e4a00a20?w=400',
      title: 'Harbor View', event: 'fall-picnic-2024', members: ['bob-wilson', 'sarah-davis'] },
      
    // Happy Hikers Nov
    { id: 4, src: 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=1200',
      thumb: 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=400',
      title: 'Summit Group', event: 'happy-hikers-nov', members: ['john-smith', 'tom-brown', 'mary-johnson'] },
    { id: 5, src: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=1200',
      thumb: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=400',
      title: 'Mountain Vista', event: 'happy-hikers-nov', members: ['mary-johnson'] },
      
    // Happy Hikers Oct  
    { id: 6, src: 'https://images.unsplash.com/photo-1501555088652-021faa106b9b?w=1200',
      thumb: 'https://images.unsplash.com/photo-1501555088652-021faa106b9b?w=400',
      title: 'Trail Start', event: 'happy-hikers-oct', members: ['john-smith', 'sarah-davis'] },
      
    // Golf Sandpiper
    { id: 7, src: 'https://images.unsplash.com/photo-1535131749006-b7f58c99034b?w=1200',
      thumb: 'https://images.unsplash.com/photo-1535131749006-b7f58c99034b?w=400',
      title: 'First Tee', event: 'golf-sandpiper', members: ['bob-wilson', 'tom-brown'] },
    { id: 8, src: 'https://images.unsplash.com/photo-1593111774240-d529f12cf4bb?w=1200',
      thumb: 'https://images.unsplash.com/photo-1593111774240-d529f12cf4bb?w=400',
      title: 'Winners Circle', event: 'golf-sandpiper', members: ['john-smith', 'sarah-davis', 'bob-wilson'] },
      
    // Golf Glen Annie
    { id: 9, src: 'https://images.unsplash.com/photo-1587174486073-ae5e5cff23aa?w=1200',
      thumb: 'https://images.unsplash.com/photo-1587174486073-ae5e5cff23aa?w=400',
      title: 'Putting Green', event: 'golf-glen-annie', members: ['tom-brown', 'bob-wilson'] },
      
    // Wine Santa Ynez
    { id: 10, src: 'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=1200',
      thumb: 'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=400',
      title: 'Wine Tasting', event: 'wine-santa-ynez', members: ['mary-johnson', 'sarah-davis', 'jennifer-lee'] },
      
    // Wine Los Olivos
    { id: 11, src: 'https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=1200',
      thumb: 'https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=400',
      title: 'Vineyard Tour', event: 'wine-los-olivos', members: ['bob-wilson', 'tom-brown', 'john-smith'] },
    { id: 12, src: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1200',
      thumb: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400',
      title: 'Group Toast', event: 'wine-los-olivos', members: ['mary-johnson', 'john-smith', 'lisa-martinez'] },
      
    // Holiday Party 2024
    { id: 13, src: 'https://images.unsplash.com/photo-1482517967863-00e15c9b44be?w=1200',
      thumb: 'https://images.unsplash.com/photo-1482517967863-00e15c9b44be?w=400',
      title: 'Dance Floor', event: 'holiday-party-2024', members: ['john-smith', 'mary-johnson', 'bob-wilson', 'sarah-davis'] },
    { id: 14, src: 'https://images.unsplash.com/photo-1467810563316-b5476525c0f9?w=1200',
      thumb: 'https://images.unsplash.com/photo-1467810563316-b5476525c0f9?w=400',
      title: 'Decorations', event: 'holiday-party-2024', members: [] },
    { id: 15, src: 'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=1200',
      thumb: 'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=400',
      title: 'Party Fun', event: 'holiday-party-2024', members: ['tom-brown', 'jennifer-lee'] },
];

// Current filter state
let currentFilters = {
    member: null,
    activity: null,
    event: null,
    year: null
};

// Initialize Select2 for member search
$(document).ready(function() {
    $('#member-search').select2({
        placeholder: 'Type to search members...',
        allowClear: true,
        minimumInputLength: 1,
        data: members.map(m => ({
            id: m.id,
            text: m.name,
            photoCount: m.photoCount,
            thumb: m.thumb
        })),
        templateResult: formatMember,
        templateSelection: formatMemberSelection
    });
    
    // Bind filter changes
    $('#member-search').on('change', applyFilters);
    $('#filter-activity').on('change', applyFilters);
    $('#filter-event').on('change', applyFilters);
    $('#filter-year').on('change', applyFilters);
    
    // Initial render - show events
    renderGallery();
});

function formatMember(member) {
    if (!member.id) return member.text;
    return $('<div class="member-option">' +
        '<img src="' + member.thumb + '" />' +
        '<div><div class="name">' + member.text + '</div>' +
        '<div class="count">' + member.photoCount + ' photos</div></div></div>');
}

function formatMemberSelection(member) {
    return member.text || 'Type to search members...';
}

function applyFilters() {
    currentFilters.member = $('#member-search').val() || null;
    currentFilters.activity = $('#filter-activity').val() || null;
    currentFilters.event = $('#filter-event').val() || null;
    currentFilters.year = $('#filter-year').val() || null;
    
    updateActiveFilters();
    renderGallery();
}

function updateActiveFilters() {
    const $container = $('#active-filters');
    $container.empty();
    
    let hasFilters = false;
    
    if (currentFilters.member) {
        const member = members.find(m => m.id === currentFilters.member);
        if (member) {
            $container.append('<span class="filter-tag person">' + member.name + 
                ' <span class="remove" onclick="removeFilter(\'member\')">‚úï</span></span>');
            hasFilters = true;
        }
    }
    
    if (currentFilters.activity) {
        const name = $('#filter-activity option:selected').text();
        $container.append('<span class="filter-tag">' + name + 
            ' <span class="remove" onclick="removeFilter(\'activity\')">‚úï</span></span>');
        hasFilters = true;
    }
    
    if (currentFilters.event) {
        const name = $('#filter-event option:selected').text();
        $container.append('<span class="filter-tag event">' + name + 
            ' <span class="remove" onclick="removeFilter(\'event\')">‚úï</span></span>');
        hasFilters = true;
    }
    
    if (currentFilters.year) {
        $container.append('<span class="filter-tag">' + currentFilters.year + 
            ' <span class="remove" onclick="removeFilter(\'year\')">‚úï</span></span>');
        hasFilters = true;
    }
    
    if (hasFilters) {
        $container.prepend('<span class="active-filters-label">Active filters:</span>');
        $container.addClass('visible');
    } else {
        $container.removeClass('visible');
    }
}

function removeFilter(type) {
    currentFilters[type] = null;
    if (type === 'member') $('#member-search').val(null).trigger('change.select2');
    if (type === 'activity') $('#filter-activity').val('');
    if (type === 'event') $('#filter-event').val('');
    if (type === 'year') $('#filter-year').val('');
    applyFilters();
}

function clearFilters() {
    currentFilters = { member: null, activity: null, event: null, year: null };
    $('#member-search').val(null).trigger('change.select2');
    $('#filter-activity').val('');
    $('#filter-event').val('');
    $('#filter-year').val('');
    updateActiveFilters();
    renderGallery();
}

function renderGallery() {
    const $content = $('#gallery-content');
    const $count = $('#results-count');
    const $mode = $('#view-mode');
    
    // Determine display mode based on filters
    const hasFilters = Object.values(currentFilters).some(v => v);
    
    if (!hasFilters) {
        // NO FILTERS: Show events as album covers
        renderEventGrid($content, events);
        $count.html('Showing <strong>' + events.length + ' events</strong>');
        $mode.html('üìÅ Browse Events');
        
    } else if (currentFilters.event) {
        // EVENT SELECTED: Show all photos in that event
        const eventPhotos = photos.filter(p => p.event === currentFilters.event);
        const event = events.find(e => e.id === currentFilters.event);
        renderPhotoGrid($content, eventPhotos, event ? event.name : 'Event');
        $count.html('Showing <strong>' + eventPhotos.length + ' photos</strong> in ' + (event ? event.name : 'event'));
        $mode.html('üì∑ Event Photos');
        
    } else if (currentFilters.member) {
        // MEMBER SELECTED: Show their photos grouped by event
        const memberPhotos = photos.filter(p => p.members.includes(currentFilters.member));
        const member = members.find(m => m.id === currentFilters.member);
        
        // Further filter by activity if selected
        let filteredPhotos = memberPhotos;
        if (currentFilters.activity) {
            const activityEvents = events.filter(e => e.activity === currentFilters.activity).map(e => e.id);
            filteredPhotos = memberPhotos.filter(p => activityEvents.includes(p.event));
        }
        
        renderGroupedPhotos($content, filteredPhotos, member ? member.name : 'Member');
        $count.html('Showing <strong>' + filteredPhotos.length + ' photos</strong> of ' + (member ? member.name : 'member'));
        $mode.html('üì∑ Photos by Event');
        
    } else if (currentFilters.activity) {
        // ACTIVITY SELECTED: Show events in that activity
        const activityEvents = events.filter(e => e.activity === currentFilters.activity);
        renderEventGrid($content, activityEvents);
        const activityName = $('#filter-activity option:selected').text();
        $count.html('Showing <strong>' + activityEvents.length + ' events</strong> in ' + activityName);
        $mode.html('üìÅ Activity Events');
        
    } else if (currentFilters.year) {
        // YEAR SELECTED: Show events from that year
        const yearEvents = events.filter(e => e.date.includes(currentFilters.year));
        renderEventGrid($content, yearEvents);
        $count.html('Showing <strong>' + yearEvents.length + ' events</strong> from ' + currentFilters.year);
        $mode.html('üìÅ Events by Year');
    }
}

function renderEventGrid($container, eventList) {
    let html = '<div class="event-grid">';
    
    eventList.forEach(event => {
        html += `
            <div class="event-card" onclick="selectEvent('${event.id}')">
                <div class="event-card-image">
                    <img src="${event.coverImage}" alt="${event.name}">
                    <div class="event-card-badge">${event.photoCount} photos</div>
                    <div class="event-card-overlay">
                        <div class="event-card-title">${event.name}</div>
                        <div class="event-card-meta">${event.date}</div>
                    </div>
                </div>
                <div class="event-card-activity">
                    <span class="activity-icon">${event.activityName.split(' ')[0]}</span>
                    ${event.activityName.substring(2)}
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    $container.html(html);
}

function renderPhotoGrid($container, photoList, title) {
    let html = '<div class="photo-grid">';
    
    photoList.forEach(photo => {
        html += `
            <div class="photo-thumb" onclick="openLightbox('${photo.src}')">
                <img src="${photo.thumb}" alt="${photo.title}">
                <div class="photo-thumb-title">${photo.title}</div>
            </div>
        `;
    });
    
    html += '</div>';
    $container.html(html);
}

function renderGroupedPhotos($container, photoList, memberName) {
    // Group photos by event
    const grouped = {};
    photoList.forEach(photo => {
        if (!grouped[photo.event]) {
            grouped[photo.event] = [];
        }
        grouped[photo.event].push(photo);
    });
    
    let html = '';
    
    Object.keys(grouped).forEach(eventId => {
        const event = events.find(e => e.id === eventId);
        const eventPhotos = grouped[eventId];
        
        html += `
            <div class="event-section">
                <div class="event-section-header">
                    <div class="event-section-title">
                        ${event ? event.name : eventId}
                        <span class="date">${event ? event.date : ''}</span>
                    </div>
                    <span class="event-section-count">${eventPhotos.length} photos</span>
                </div>
                <div class="event-section-photos">
        `;
        
        eventPhotos.forEach(photo => {
            html += `
                <div class="photo-thumb" onclick="openLightbox('${photo.src}')">
                    <img src="${photo.thumb}" alt="${photo.title}">
                    <div class="photo-thumb-title">${photo.title}</div>
                </div>
            `;
        });
        
        html += '</div></div>';
    });
    
    if (html === '') {
        html = '<p style="text-align: center; color: #666; padding: 40px;">No photos found matching your filters.</p>';
    }
    
    $container.html(html);
}

function selectEvent(eventId) {
    $('#filter-event').val(eventId);
    applyFilters();
}

function openLightbox(src) {
    $('#lightbox-img').attr('src', src);
    $('#lightbox').addClass('active');
}

function closeLightbox() {
    $('#lightbox').removeClass('active');
}

// Close lightbox on escape key
$(document).keydown(function(e) {
    if (e.key === 'Escape') closeLightbox();
});
</script>

</body>
</html>
